webpackJsonp([28],{"94Cj":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let i=a("09cW");var n={name:"Recharge",data:()=>({loading:!1,tableDatas:[],payInfo:[],cancel:{money:0,sn:"",modal:!1,payModal:!1},payCode:{value:"",size:300,backgroundAlpha:1,background:"white",foreground:"black",level:"L"},loadingTimer:null,loadingTimerDuration:5e3,audio:{src:i,open:"open"===localStorage.getItem("order/recharge/audio/open/status")}}),computed:{tableColumns(){let e=this,t=[];return t.push({title:this.$t("uc.otcorder.orderno"),key:"orderSn",minWidth:60,align:"center",render:function(t,a){return t("p",[t("a",{on:{click:function(){e.$router.push("/chat?tradeId="+a.row.orderSn)}},class:"vc-text--link"},a.row.orderSn)])}}),t.push({title:this.$t("uc.otcorder.created"),key:"createTime",minWidth:90,align:"center"}),t.push({title:this.$t("uc.otcorder.tradename"),key:"name",ellipsis:"true",align:"center",render:function(t,a){return t("p",[t("a",{on:{click:function(){e.$router.push("/checkuser?id="+a.row.name)}},class:"vc-text--link"},a.row.name)])}}),t.push({title:this.$t("uc.otcorder.amount"),key:"amount",align:"center"}),t.push({title:this.$t("uc.otcorder.money"),key:"money",align:"center"}),t.push({title:"付款方式",key:"payMode",align:"center"}),t.push({title:"剩余时间",key:"commission",align:"center",render:(t,a)=>t("span",{class:"vc-text--pramiry"},e.strTime(a.row&&a.row.leftTime,!1))}),t.push({title:"操作",key:"done",align:"center",render:(t,a,i)=>a.row&&0==a.row.type?t("p",[t("Button",{on:{click:function(){let t=a.row&&a.row.orderSn;e.cancel.money=a.row&&a.row.money,e.cancel.sn=t,e.getOrderDatail(t)}},props:{type:"warning"},style:{marginRight:"8px",marginBottom:"8px"}},"去付款")]):t("span",{class:"vc-text--danger"},"等待付款")}),t}},mounted(){this.initPage()},methods:{strTime(e,t=!0){if(Number(e)<0)return 0;e=t?e:1e3*e;let a=Math.floor(e/6e4),i=Math.floor((e-6e4*a)/1e3);return 0===a&&0===i?"已过期":0===a?`${i}秒`:`${a}分 ${i}秒`},initPage(){this.getOrder(!0),this.setLoadingTimer()},cancelOrder(){this.$http.post(this.host+"/otc/order/pay",{orderSn:this.cancel.sn}).then(e=>{var t=e.body;0==t.code?(this.$Message.success(t.message),this.cancel.payModal=!1,this.cancel.sn="",this.initPage()):this.$Message.error(t.message)})},setLoadingTimer(){this.clearLoadingTimer(),this.loadingTimer=setInterval(()=>{this.getOrder(!1),this.cancel.sn&&!this.isExit()&&(this.$Message.error("订单已过期！"),this.cancel.payModal=!1,this.cancel.sn="")},this.loadingTimerDuration)},isExit(){for(let e=0;e<this.tableDatas.length;e++){if(this.tableDatas[e].orderSn===this.cancel.sn)return!0}return!1},clearLoadingTimer(){clearInterval(this.loadingTimer),this.loadingTimer=null},getOrder(e=!1){this.loading=e;this.$http.post(this.host+"/otc/order/goToPay").then(e=>{var t=e.body;0==t.code&&t.data?(this.tableDatas=t.data,this.isEmergeNewOrder()):this.$Message.error(t.message),this.loading=!1})},getOrderDatail(e){this.$http.post(this.host+"/otc/order/detail",{orderSn:e}).then(e=>{var t=e.body;if(0==t.code&&t.data.payInfo){let e=t.data.payInfo;this.payInfo=[];let a=t.data.payMode&&t.data.payMode.split(",");if(a.indexOf("支付宝")>-1&&e.alipay){let t={title:e.alipay.alipay,value:e.alipay.alipayUrl,value2:e.alipay.alipayCodeUrl,realName:e.alipay.alipayRealName,key:"ali",type:"支付宝"};this.payInfo.push(t)}if(a.indexOf("银联")>-1&&e.bankInfo){let t={key:"card",type:"银行卡",title:e.bankInfo.bankRealName,value:e.bankInfo.cardNo,value2:e.bankInfo.bank};this.payInfo.push(t)}if(a.indexOf("微信")>-1&&e.wechatPay){let t={type:"微信",key:"wx",title:e.wechatPay.wechat,value:e.wechatPay.wechatUrl,value2:e.wechatPay.qrWeCodeUrl};this.payInfo.push(t)}if(a.indexOf("云闪付")>-1&&e.unionpay){let t={type:"云闪付",key:"unionpay",title:e.unionpay.unionpay,value:e.unionpay.unionpayUrl,value2:e.unionpay.unionpayCodeUrl};this.payInfo.push(t)}this.cancel.payModal=!0}else this.$Message.error("获取付款方式失败！"),this.cancel.payModal=!1})},isEmergeNewOrder(){let e=0;this.tableDatas.forEach(t=>{e=Math.max(e,t.orderId)});let t=localStorage.getItem("order/recharge/new/unique/id")||0;localStorage.setItem("order/recharge/new/unique/id",e),t<e&&this.audio.open&&this.playAudio()},playAudio:function(){var e=document.getElementById("noticeMusic");null!==e&&e.play()}},watch:{"audio.open"(e){localStorage.setItem("order/recharge/audio/open/status",e?"open":"close")}},beforeDestroy(){this.clearLoadingTimer()}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"nav-rights"},[a("audio",{attrs:{id:"noticeMusic",src:e.audio.src}},[e._v("\n    您的浏览器不支持 audio 标签。\n  ")]),e._v(" "),a("div",{staticClass:"nav-right"},[a("div",{staticClass:"bill_box_order"},[a("div",{staticStyle:{marginBottom:"10px","text-align":"right"}},[a("Checkbox",{model:{value:e.audio.open,callback:function(t){e.$set(e.audio,"open",t)},expression:"audio.open"}},[e._v("\n          "+e._s(e.audio.open?"关闭":"开启")+"新订单消息提醒")])],1),e._v(" "),a("div",[a("Table",{attrs:{"no-data-text":"暂无买入订单",columns:e.tableColumns,data:e.tableDatas,loading:e.loading,"disabled-hover":!0}})],1)])]),e._v(" "),a("Modal",{staticClass:"ivu-modal--left",attrs:{title:e.$t("otc.chat.tip"),"mask-closable":!1,width:"400px"},on:{"on-ok":function(t){e.cancelOrder()}},model:{value:e.cancel.modal,callback:function(t){e.$set(e.cancel,"modal",t)},expression:"cancel.modal"}},[a("p",{staticStyle:{color:"red","font-weight":"bold"}},[e._v(e._s(e.$t("otc.chat.msg1")))])]),e._v(" "),a("Modal",{staticClass:"ivu-modal--left",attrs:{"mask-closable":!1,width:"400px"},model:{value:e.cancel.payModal,callback:function(t){e.$set(e.cancel,"payModal",t)},expression:"cancel.payModal"}},[a("div",{attrs:{slot:"header"},slot:"header"},[a("p",{staticStyle:{"text-align":"center"}},[e._v("\n        "+e._s(e.cancel.sn)+"\n      ")])]),e._v(" "),a("div",{staticClass:"vp-paytype"},[a("div",{staticClass:"vp-paytype__label"},[a("span",{staticStyle:{"font-size":"50px"}},[e._v("￥ "+e._s(e.cancel.money))])]),e._v(" "),a("div",{staticClass:"vp-paytype__body"},e._l(e.payInfo,function(t,i){return a("div",{key:i,staticClass:"vp-payType__item"},[a("span",{staticClass:"vp-text__type"},[e._v(e._s(t.type))]),e._v(" "),a("div",{staticClass:"vp-payType__content"},[a("span",{staticClass:"vp-text__title"},[e._v(e._s(t.title)+"\n              "),t.realName?a("span",{staticClass:"vp-text__title"},[e._v("("+e._s(t.realName)+")\n              ")]):e._e()]),e._v(" "),"card"===t.key?a("span",{staticClass:"vp-text__value",staticStyle:{"font-size":"20px"}},[e._v("\n              "+e._s(t.value))]):e._e(),e._v(" "),"card"===t.key?a("span",{staticClass:"vp-text__value",staticStyle:{"font-size":"20px"}},[e._v("\n              "+e._s(t.value2))]):a("div",[t.value?a("div",{staticStyle:{position:"relative"}},[a("div",{staticStyle:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)","background-color":"white"}},[a("i",{staticClass:"icons ",class:{"alipay-plus":"ali"==t.key,"wechat-plus":"wx"==t.key,"unionpay-plus":"unionpay"==t.key},staticStyle:{height:"50px",width:"50px"}})]),e._v(" "),a("qriously",{attrs:{value:t.value,size:e.payCode.size,level:e.payCode.level,background:e.payCode.background,foreground:e.payCode.foreground,backgroundAlpha:e.payCode.backgroundAlpha}})],1):a("div",{style:{width:e.payCode.size+"px",height:e.payCode.size+"px",textAlign:"center"}},[a("img",{style:{height:"100%",width:"auto"},attrs:{src:t.value2,alt:""}})])])])])})),e._v(" "),a("div",{staticStyle:{"text-align":"center",padding:"10px"}},[a("Button",{attrs:{type:"warning"},nativeOn:{click:function(t){return e.cancelOrder(t)}}},[e._v("完成付款")])],1)]),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"})])],1)},staticRenderFns:[]};var s=a("VU/8")(n,o,!1,function(e){a("ldEq")},null,null);t.default=s.exports},ldEq:function(e,t){}});