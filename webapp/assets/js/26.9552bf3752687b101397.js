webpackJsonp([26],{gPfZ:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});a("FZuG");let i=a("09cW");var s={name:"Recharge",data:()=>({loading:!1,tableDatas:[],payTypeModal:!1,loadingTimer:null,loadingTimerDuration:5e3,payInfo:[],withdraw:{modal:!1,value:"",sn:""},recharge:{modal:!1,value:"",sn:""},payCode:{value:"",size:300,backgroundAlpha:1,background:"white",foreground:"black",level:"L"},audio:{src:i,open:"open"===localStorage.getItem("order/withdraw/audio/open/status")}}),computed:{tableColumns(){let e=this,t=[];return t.push({title:"订单号",key:"orderSn",minWidth:60,align:"center",render:function(t,a){return t("p",[t("a",{on:{click:function(){e.$router.push("/chat?tradeId="+a.row.orderSn)}},class:"vc-text--link"},a.row.orderSn)])}}),t.push({title:"交易类型",key:"type",align:"center",render:(e,t)=>{let a="";return e("div",a=0==t.row.type?"买入":"卖出")}}),t.push({title:"创建时间",key:"createTime",minWidth:90,align:"center"}),t.push({title:"交易对象",key:"name",ellipsis:"true",align:"center",render:function(t,a){return t("p",[t("a",{on:{click:function(){e.$router.push("/checkuser?id="+a.row.name)}},class:"vc-text--link"},a.row.name)])}}),t.push({title:"数量",key:"amount",align:"center"}),t.push({title:"金额",key:"money",align:"center"}),t.push({title:"备注",key:"payRemark",align:"center"}),t.push({title:"支付/收款方式",key:"payMode",align:"center"}),t.push({title:"操作",key:"done",align:"center",render:(t,a,i)=>a.row&&1==a.row.type?t("p",[t("Button",{on:{click:function(){e.withdraw.modal=!0,e.withdraw.sn=a.row&&a.row.orderSn}},props:{type:"warning"},style:{marginRight:"8px",marginBottom:"8px"}},"确认放币")]):t("p",[t("Button",{on:{click:function(){let t=a.row&&a.row.orderSn;e.recharge.money=a.row&&a.row.money,e.recharge.sn=t,e.getOrderDatail(t)}},props:{type:"success"},style:{marginRight:"8px",marginBottom:"8px"}},"去付款")])}),t}},mounted(){this.initPage()},methods:{initPage(){this.getOrder(!0),this.setLoadingTimer()},setLoadingTimer(){this.clearLoadingTimer(),this.loadingTimer=setInterval(()=>{this.getOrder(!1)},this.loadingTimerDuration)},clearLoadingTimer(){clearInterval(this.loadingTimer),this.loadingTimer=null},cancelOrder(e){if("withdraw"===e){var t={orderSn:this.withdraw.sn,jyPassword:this.withdraw.value};if(""==t.jyPassword)return void this.$Message.error("请输入交易密码");this.$http.post(this.host+"/otc/order/release",t).then(e=>{var t=e.body;0==t.code?(this.$Message.success(t.message),this.initPage()):this.$Message.error(t.message)})}else this.$http.post(this.host+"/otc/order/pay",{orderSn:this.recharge.sn}).then(e=>{var t=e.body;0==t.code?(this.$Message.success(t.message),this.recharge.modal=!1,this.recharge.sn="",this.initPage()):this.$Message.error(t.message)})},getOrderDatail(e){this.$http.post(this.host+"/otc/order/detail",{orderSn:e}).then(e=>{var t=e.body;if(0==t.code&&t.data.payInfo){let e=t.data.payInfo;this.payInfo=[];let a=t.data.payMode&&t.data.payMode.split(",");if(a.indexOf("支付宝")>-1&&e.alipay){let t={title:e.alipay.alipay,value:e.alipay.alipayUrl,value2:e.alipay.alipayCodeUrl,realName:e.alipay.alipayRealName,key:"ali",type:"支付宝"};this.payInfo.push(t)}if(a.indexOf("银联")>-1&&e.bankInfo){let t={key:"card",type:"银行卡",title:e.bankInfo.bankRealName,value:e.bankInfo.cardNo,value2:e.bankInfo.bank};this.payInfo.push(t)}if(a.indexOf("微信")>-1&&e.wechatPay){let t={type:"微信",key:"wx",title:e.wechatPay.wechat,value:e.wechatPay.wechatUrl,value2:e.wechatPay.qrWeCodeUrl};this.payInfo.push(t)}if(a.indexOf("云闪付")>-1&&e.unionpay){let t={type:"云闪付",key:"unionpay",title:e.unionpay.unionpay,value:e.unionpay.unionpayUrl,value2:e.unionpay.unionpayCodeUrl};this.payInfo.push(t)}this.recharge.modal=!0}else this.$Message.error("获取付款方式失败！"),this.recharge.modal=!1})},getOrder(e=!1){this.loading=e;this.$http.post(this.host+"/otc/order/goToPayOrConfirm").then(e=>{var t=e.body;0===t.code&&t.data?(this.tableDatas=t.data,this.isEmergeNewOrder()):this.$Message.error(t.message),this.loading=!1})},isEmergeNewOrder(){let e=0;this.tableDatas.forEach(t=>{e=Math.max(e,t.orderId)});let t=localStorage.getItem("order/rechage-withdraw/new/unique/id")||0;localStorage.setItem("order/rechage-withdraw/new/unique/id",e),t<e&&this.audio.open&&this.playAudio()},playAudio:function(){var e=document.getElementById("noticeMusic");null!==e&&e.play()}},watch:{"audio.open"(e){localStorage.setItem("order/withdraw/audio/open/status",e?"open":"close")}},beforeDestroy(){this.clearLoadingTimer()}},r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"nav-rights"},[a("div",{staticStyle:{"margin-bottom":"10px","text-align":"center",overflow:"hidden"}},[a("span",{staticStyle:{float:"right"}},[a("Checkbox",{model:{value:e.audio.open,callback:function(t){e.$set(e.audio,"open",t)},expression:"audio.open"}},[e._v("\n        "+e._s(e.audio.open?"关闭":"开启")+"新订单消息提醒\n      ")])],1)]),e._v(" "),a("audio",{attrs:{id:"noticeMusic",src:e.audio.src}},[e._v("\n    您的浏览器不支持 audio 标签。\n  ")]),e._v(" "),a("div",{staticClass:"nav-right"},[a("div",{staticClass:"bill_box_order"},[a("div",[a("Table",{attrs:{"no-data-text":"暂无订单",columns:e.tableColumns,data:e.tableDatas,loading:e.loading,"disabled-hover":!0}})],1)])]),e._v(" "),a("Modal",{staticClass:"ivu-modal--left",attrs:{title:"提示","mask-closable":!1,width:"400px"},on:{"on-ok":function(t){e.cancelOrder("withdraw")}},model:{value:e.withdraw.modal,callback:function(t){e.$set(e.withdraw,"modal",t)},expression:"withdraw.modal"}},[a("div",{},[a("div",{staticClass:"vui-margin-bottom"},[a("span",{staticClass:"vui-color--danger"},[e._v("是否确认放币？")])]),e._v(" "),a("div",[a("Input",{attrs:{type:"password",placeholder:"请输入资金交易密码",autocomplete:"off"},model:{value:e.withdraw.value,callback:function(t){e.$set(e.withdraw,"value",t)},expression:"withdraw.value"}})],1)])]),e._v(" "),a("Modal",{staticClass:"ivu-modal--left",attrs:{"mask-closable":!1,width:"400px"},model:{value:e.recharge.modal,callback:function(t){e.$set(e.recharge,"modal",t)},expression:"recharge.modal"}},[a("div",{attrs:{slot:"header"},slot:"header"},[a("p",{staticStyle:{"text-align":"center"}},[e._v("\n        "+e._s(e.recharge.sn)+"\n      ")])]),e._v(" "),a("div",{staticClass:"vp-paytype"},[a("div",{staticClass:"vp-paytype__label"},[a("span",{staticStyle:{"font-size":"50px"}},[e._v("￥ "+e._s(e.recharge.money))])]),e._v(" "),a("div",{staticClass:"vp-paytype__body"},e._l(e.payInfo,function(t,i){return a("div",{key:i,staticClass:"vp-payType__item"},[a("span",{staticClass:"vp-text__type"},[e._v(e._s(t.type))]),e._v(" "),a("div",{staticClass:"vp-payType__content"},[a("span",{staticClass:"vp-text__title"},[e._v(e._s(t.title)+"\n              "),t.realName?a("span",{staticClass:"vp-text__title"},[e._v("("+e._s(t.realName)+")\n              ")]):e._e()]),e._v(" "),"card"===t.key?a("span",{staticClass:"vp-text__value",staticStyle:{"font-size":"20px"}},[e._v("\n              "+e._s(t.value))]):e._e(),e._v(" "),"card"===t.key?a("span",{staticClass:"vp-text__value",staticStyle:{"font-size":"20px"}},[e._v("\n              "+e._s(t.value2))]):a("div",[t.value?a("div",{staticStyle:{position:"relative"}},[a("div",{staticStyle:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)","background-color":"white"}},[a("i",{staticClass:"icons ",class:{"alipay-plus":"ali"==t.key,"wechat-plus":"wx"==t.key,"unionpay-plus":"unionpay"==t.key},staticStyle:{height:"50px",width:"50px"}})]),e._v(" "),a("qriously",{attrs:{value:t.value,size:e.payCode.size,level:e.payCode.level,background:e.payCode.background,foreground:e.payCode.foreground,backgroundAlpha:e.payCode.backgroundAlpha}})],1):a("div",{style:{width:e.payCode.size+"px",height:e.payCode.size+"px",textAlign:"center"}},[a("img",{style:{height:"100%",width:"auto"},attrs:{src:t.value2,alt:""}})])])])])})),e._v(" "),a("div",{staticStyle:{"text-align":"center",padding:"10px"}},[a("Button",{attrs:{type:"warning"},nativeOn:{click:function(t){e.cancelOrder("recharge")}}},[e._v("完成付款")])],1)]),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"})])],1)},staticRenderFns:[]};var o=a("VU/8")(s,r,!1,function(e){a("xR3/")},null,null);t.default=o.exports},"xR3/":function(e,t){}});